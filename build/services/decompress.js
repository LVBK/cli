'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _decompress = require('decompress');

var _decompress2 = _interopRequireDefault(_decompress);

var _downloadCached = require('download-cached');

var _downloadCached2 = _interopRequireDefault(_downloadCached);

var _homeDir = require('../home-dir');

var _homeDir2 = _interopRequireDefault(_homeDir);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const cacheDir = _path2.default.join((0, _homeDir2.default)(), 'cache', 'cached-requests');
const download = (0, _downloadCached2.default)(cacheDir, _downloadCached2.default.fetchGet(fetch));

exports.default = async function (url, destination, options) {
  if (!options.useCache) {
    await download.clear(url);
  }

  const onData = options.progress || (() => {});

  const tmpPath = await download.toCache(url, { onData });
  await (0, _decompress2.default)(tmpPath, destination, options);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy9kZWNvbXByZXNzLmpzIl0sIm5hbWVzIjpbImNhY2hlRGlyIiwicGF0aCIsImpvaW4iLCJkb3dubG9hZCIsImRvd25sb2FkQ2FjaGVkIiwiZmV0Y2hHZXQiLCJmZXRjaCIsInVybCIsImRlc3RpbmF0aW9uIiwib3B0aW9ucyIsInVzZUNhY2hlIiwiY2xlYXIiLCJvbkRhdGEiLCJwcm9ncmVzcyIsInRtcFBhdGgiLCJ0b0NhY2hlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRUEsTUFBTUEsV0FBV0MsZUFBS0MsSUFBTCxDQUFVLHdCQUFWLEVBQXdCLE9BQXhCLEVBQWlDLGlCQUFqQyxDQUFqQjtBQUNBLE1BQU1DLFdBQVcsOEJBQWVILFFBQWYsRUFBeUJJLHlCQUFlQyxRQUFmLENBQXdCQyxLQUF4QixDQUF6QixDQUFqQjs7a0JBRWUsZ0JBQWVDLEdBQWYsRUFBb0JDLFdBQXBCLEVBQWlDQyxPQUFqQyxFQUEwQztBQUN2RCxNQUFJLENBQUNBLFFBQVFDLFFBQWIsRUFBdUI7QUFDckIsVUFBTVAsU0FBU1EsS0FBVCxDQUFlSixHQUFmLENBQU47QUFDRDs7QUFFRCxRQUFNSyxTQUFTSCxRQUFRSSxRQUFSLEtBQXFCLE1BQU0sQ0FBRSxDQUE3QixDQUFmOztBQUVBLFFBQU1DLFVBQVUsTUFBTVgsU0FBU1ksT0FBVCxDQUFpQlIsR0FBakIsRUFBc0IsRUFBRUssTUFBRixFQUF0QixDQUF0QjtBQUNBLFFBQU0sMEJBQVdFLE9BQVgsRUFBb0JOLFdBQXBCLEVBQWlDQyxPQUFqQyxDQUFOO0FBQ0QsQyIsImZpbGUiOiJkZWNvbXByZXNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCBkZWNvbXByZXNzIGZyb20gJ2RlY29tcHJlc3MnO1xyXG5pbXBvcnQgZG93bmxvYWRDYWNoZWQgZnJvbSAnZG93bmxvYWQtY2FjaGVkJztcclxuaW1wb3J0IGdldEhvbWVEaXIgZnJvbSAnLi4vaG9tZS1kaXInO1xyXG5cclxuY29uc3QgY2FjaGVEaXIgPSBwYXRoLmpvaW4oZ2V0SG9tZURpcigpLCAnY2FjaGUnLCAnY2FjaGVkLXJlcXVlc3RzJyk7XHJcbmNvbnN0IGRvd25sb2FkID0gZG93bmxvYWRDYWNoZWQoY2FjaGVEaXIsIGRvd25sb2FkQ2FjaGVkLmZldGNoR2V0KGZldGNoKSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbih1cmwsIGRlc3RpbmF0aW9uLCBvcHRpb25zKSB7XHJcbiAgaWYgKCFvcHRpb25zLnVzZUNhY2hlKSB7XHJcbiAgICBhd2FpdCBkb3dubG9hZC5jbGVhcih1cmwpO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgb25EYXRhID0gb3B0aW9ucy5wcm9ncmVzcyB8fCAoKCkgPT4ge30pO1xyXG5cclxuICBjb25zdCB0bXBQYXRoID0gYXdhaXQgZG93bmxvYWQudG9DYWNoZSh1cmwsIHsgb25EYXRhIH0pO1xyXG4gIGF3YWl0IGRlY29tcHJlc3ModG1wUGF0aCwgZGVzdGluYXRpb24sIG9wdGlvbnMpO1xyXG59XHJcbiJdfQ==